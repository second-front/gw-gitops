global:
  image: 
    defaultImageRegistry: r.gamewarden.io
    defaultImageRepository: base

microservices:
  santonio:
    initContainers:
    - name: fix-permissions
      image: 'r.gamewarden.io/base/santonio:1.0'
      command: ["sh", "-c", "chown -R 101:101 /var/cache/nginx"]
      securityContext:
        runAsUser: 0  # Run as root to fix permissions
      volumeMounts:
        - name: nginx-cache
          mountPath: /var/cache/nginx
    securityContext:
      readOnlyRootFilesystem: false
      runAsUser: 101
      runAsGroup: 101
      allowPrivilegeEscalation: true
      runAsNonRoot: false
    image:
      tag: "1.0"

manifests:
  vs:
    apiVersion: networking.istio.io/v1
    kind: VirtualService
    metadata:
      name: hackathon
    spec:
      gateways:
      - istio-system/public
      hosts:
      - satonio.gw.local
      http:
      - route:
        - destination:
            host: santonio
            port:
              number: 8080
